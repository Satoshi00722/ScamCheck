{% extends "base.html" %}

{% block title %}Group Check — ScamCheck{% endblock %}
{% block h1 %}Group Check{% endblock %}

{% block content %}
{% if not sub %}
  <div class="locked">
    <p>Premium required.</p>
    <a class="btn" href="/subscription">Get Premium</a>
  </div>
{% else %}
  <form method="get" action="/group" class="checker">
    <input type="url" name="link" placeholder="Paste Telegram or Discord invite URL" value="{{ link or '' }}" required>
    <button class="btn glow" type="submit">Analyze</button>
  </form>

  {% if result %}
    {% if result.ok %}
      {# --- маппинг цветов в CSS-бейдж --- #}
      {% set badge_class = "green" if result.color=="green" else ("yellow" if result.color=="yellow" else "red") %}

      <div class="result-card {{ badge_class }} fade-in">
        <div class="result-head">
          <span class="badge {{ badge_class }}">{{ result.label | default("Caution") }}</span>
          <div class="score-wrap">
            <div class="score-bar">
              <div class="score-fill {{ badge_class }}" style="width: {{ (result.risk or 0) }}%"></div>
            </div>
            <div class="score-text">{{ result.risk | default(0) }}%</div>
          </div>
        </div>

        <div class="result-summary">
          {{ result.summary | default("No summary provided.") }}
          {% if result.platform %}<span class="ms-2 text-muted">• {{ result.platform }}</span>{% endif %}
          {% if result.type %}<span class="ms-2 text-muted">• {{ result.type }}</span>{% endif %}
        </div>

        <div class="result-columns">
          <div class="col">
            <h4>Signals</h4>
            <ul>
              {% for s in (result.signals or []) %}
                <li>{{ s }}</li>
              {% else %}
                <li class="text-muted">No signals.</li>
              {% endfor %}
            </ul>
          </div>
          <div class="col">
            <h4>Recommendations</h4>
            <ul>
              {% for t in (result.tips or []) %}
                <li>{{ t }}</li>
              {% else %}
                <li class="text-muted">—</li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <div class="addr">
          Link:
          <a class="link" href="{{ result.url or link }}" target="_blank" rel="noopener">
            {{ result.url or link }}
          </a>
        </div>

        {# --- отладка: можно удалить после проверки --- #}
        <details class="mt-3">
          <summary class="text-muted">Debug JSON</summary>
          <pre class="mt-2 bg-light p-2 border rounded" style="white-space: pre-wrap;">
{{ result | tojson(indent=2) }}
          </pre>
        </details>
      </div>
    {% else %}
      <div class="result-card red">
        <div class="result-summary">Error: {{ result.error | default("Unknown error") }}</div>
      </div>
    {% endif %}
  {% endif %}
{% endif %}
{% endblock %}
